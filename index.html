<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logistics CRM - Enterprise Portal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #0f172a;
            --accent-blue: #3b82f6;
            --bg-light: #f8fafc;
            --card-white: #ffffff;
            --text-main: #334155;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --success: #10b981;
            --danger: #ef4444;
            --sidebar-width: 240px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-light); color: var(--text-main); display: flex; }

        /* Sidebar Sleek */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary-blue);
            height: 100vh;
            position: fixed;
            padding: 1.5rem;
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 10px rgba(0,0,0,0.05);
        }

        .logo { font-weight: 800; font-size: 1.25rem; letter-spacing: 1px; margin-bottom: 2rem; display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--accent-blue); }

        .nav-group { margin-bottom: 1.5rem; }
        .nav-label { font-size: 0.7rem; text-transform: uppercase; color: #94a3b8; font-weight: 700; margin-bottom: 0.75rem; display: block; }
        .nav-item { 
            display: flex; align-items: center; gap: 12px; padding: 0.75rem 1rem; 
            color: #cbd5e1; text-decoration: none; border-radius: 8px; font-size: 0.9rem;
            transition: 0.3s; margin-bottom: 4px;
        }
        .nav-item:hover, .nav-item.active { background: #1e293b; color: white; }
        .nav-item i { width: 18px; font-size: 1rem; }

        /* Main Content */
        .main-container {
            margin-left: var(--sidebar-width);
            width: 100%;
            padding: 2rem;
            /* Ensure the content area always spans at least the full viewport height
               minus the sidebar to avoid unused grey areas when embedding pages. */
            min-height: 100vh;
            overflow-y: auto;
        }

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .search-box { position: relative; width: 350px; }
        .search-box input { 
            width: 100%; padding: 0.6rem 1rem 0.6rem 2.5rem; border-radius: 10px; 
            border: 1px solid var(--border-color); background: white; outline: none;
        }
        .search-box i { position: absolute; left: 15px; top: 12px; color: var(--text-muted); }

        /* Quick Stats Bar */
        .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2.5rem; }
        .stat-item { 
            background: white; padding: 1.25rem; border-radius: 12px; border: 1px solid var(--border-color);
            display: flex; align-items: center; gap: 15px;
        }
        .stat-icon { width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .stat-info h5 { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 3px; }
        .stat-info span { font-size: 1.25rem; font-weight: 700; color: var(--primary-blue); }

        /* Modules Grid */
        .section-header { 
            display: flex; align-items: center; gap: 10px; margin-bottom: 1.25rem; margin-top: 1rem;
        }
        .section-header h3 { font-size: 1rem; font-weight: 700; color: var(--primary-blue); }
        .section-header .line { flex-grow: 1; height: 1px; background: var(--border-color); }

        .module-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.25rem; margin-bottom: 2.5rem; 
        }

        .module-card { 
            background: var(--card-white); padding: 1.5rem; border-radius: 16px; 
            border: 1px solid var(--border-color); cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
        }
        .module-card:hover { 
            transform: translateY(-5px); box-shadow: 0 12px 24px rgba(0,0,0,0.06); 
            border-color: var(--accent-blue); 
        }
        .module-card::before {
            content: ""; position: absolute; top: 0; right: 0; width: 4px; height: 0;
            background: var(--accent-blue); transition: 0.3s;
        }
        .module-card:hover::before { height: 100%; }

        .card-top { display: flex; align-items: center; gap: 12px; margin-bottom: 1rem; }
        .icon-box { 
            width: 42px; height: 42px; border-radius: 10px; background: #f0f7ff; 
            color: var(--accent-blue); display: flex; align-items: center; justify-content: center; font-size: 1.1rem;
        }
        .module-card h4 { font-size: 0.95rem; font-weight: 600; }
        .module-card p { font-size: 0.8rem; color: var(--text-muted); line-height: 1.5; }
        
        .badge { 
            font-size: 0.65rem; padding: 2px 8px; border-radius: 6px; font-weight: 600;
            position: absolute; top: 1.5rem; right: 1.5rem;
        }
        .badge-alert { background: #fee2e2; color: var(--danger); }
    
        /* Sidebar Accordion + Search */
        .nav-search{
            position: relative;
            margin-bottom: 1.25rem;
        }
        .nav-search input{
            width: 100%;
            padding: 0.6rem 0.9rem 0.6rem 2.2rem;
            border-radius: 10px;
            border: 1px solid rgba(226,232,240,0.15);
            background: rgba(255,255,255,0.06);
            color: #e2e8f0;
            outline: none;
        }
        .nav-search input::placeholder{ color: #94a3b8; }
        .nav-search i{
            position: absolute;
            left: 12px;
            top: 11px;
            color: #94a3b8;
            font-size: 0.95rem;
        }

        .nav-accordion{ overflow: auto; padding-right: 4px; }
        .nav-group-acc{ margin-bottom: 0.75rem; }
        .nav-group-btn{
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            padding: 0.3rem 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            font-size: 0.7rem;
        }
        .nav-group-btn i{
            transition: transform 0.2s ease;
            font-size: 0.85rem;
        }
        .nav-group-panel{ margin-top: 0.65rem; }
        .nav-group-panel.collapsed{ display: none; }
        .nav-group-acc[data-collapsed="true"] .nav-group-btn i{ transform: rotate(-90deg); }

        /* nice scrollbar */
        .nav-accordion::-webkit-scrollbar{ width: 6px; }
        .nav-accordion::-webkit-scrollbar-thumb{ background: rgba(148,163,184,0.25); border-radius: 10px; }

    </style>
</head>
<body>

    
    <aside class="sidebar">
        <div class="logo"><i class="fas fa-cube"></i> NEXUS CRM</div>

        <div class="nav-search">
            <i class="fas fa-search"></i>
            <input id="sidebarSearch" type="text" placeholder="Tìm menu...">
        </div>

        <nav class="nav-accordion" id="navAccordion">
            <!-- MAIN -->
            <div class="nav-group-acc" data-group="main" data-collapsed="true">
                <button class="nav-group-btn" type="button" aria-expanded="false">
                    <span class="nav-label">Chính</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-group-panel collapsed">
                    <a href="#" class="nav-item active" data-page="" data-title="Tổng quan"><i class="fas fa-th-large"></i> Tổng quan</a>
                    <a href="#" class="nav-item" data-page="bi_dashboard.html" data-title="Dashboard BI"><i class="fas fa-chart-pie"></i> Dashboard BI</a>
                </div>
            </div>

            <!-- SALES & CUSTOMER -->
            <div class="nav-group-acc" data-group="sales" data-collapsed="true">
                <button class="nav-group-btn" type="button" aria-expanded="false">
                    <span class="nav-label">Sales & Khách hàng</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-group-panel collapsed">
                    <a href="#" class="nav-item" data-page="customer_360.html" data-title="Quản lý Khách hàng 360"><i class="fas fa-users"></i> Khách hàng (360º)</a>
                    <a href="#" class="nav-item" data-page="leads_opportunities.html" data-title="Lead & Cơ hội bán hàng"><i class="fas fa-funnel-dollar"></i> Lead & Cơ hội</a>
                    <a href="#" class="nav-item" data-page="contacts_management.html" data-title="Liên hệ (Contacts)"><i class="fas fa-id-card"></i> Liên hệ (Contacts) </a>
                    <a href="#" class="nav-item" data-page="quotation_management.html" data-title="Quản lý báo giá"><i class="fas fa-file-invoice"></i> Báo giá</a>
                    <a href="#" class="nav-item" data-page="sales_performance.html" data-title="Hiệu suất & Hoa hồng"><i class="fas fa-chart-line"></i> Hiệu suất & Hoa hồng</a>
                </div>
            </div>

            <!-- CONTRACT & PRICING -->
            <div class="nav-group-acc" data-group="contract" data-collapsed="true">
                <button class="nav-group-btn" type="button" aria-expanded="false">
                    <span class="nav-label">Hợp đồng & Bảng giá</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-group-panel collapsed">
                    <a href="#" class="nav-item" data-page="contract_management.html" data-title="Quản lý hợp đồng"><i class="fas fa-file-contract"></i> Hợp đồng</a>
                    <a href="#" class="nav-item" data-page="pricing_matrix.html" data-title="Ma trận giá & phụ phí"><i class="fas fa-tags"></i> Bảng giá & Phụ phí</a>
                </div>
            </div>

            <!-- OPERATIONS -->
            <div class="nav-group-acc" data-group="ops" data-collapsed="true">
                <button class="nav-group-btn" type="button" aria-expanded="false">
                    <span class="nav-label">Vận hành</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-group-panel collapsed">
                    <a href="#" class="nav-item" data-page="orders_monitoring.html" data-title="Quản lý đơn hàng"><i class="fas fa-shipping-fast"></i> Đơn hàng</a>
                    <a href="#" class="nav-item" data-page="incidents_alerts.html" data-title="Sự cố & cảnh báo"><i class="fas fa-bullhorn"></i> Sự cố & Cảnh báo</a>
                </div>
            </div>

            <!-- CUSTOMER SERVICE -->
            <div class="nav-group-acc" data-group="cs" data-collapsed="true">
                <button class="nav-group-btn" type="button" aria-expanded="false">
                    <span class="nav-label">CSKH</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-group-panel collapsed">
                    <a href="#" class="nav-item" data-page="ticketing.html" data-title="Ticket CSKH & khiếu nại"><i class="fas fa-headset"></i> Ticket & Khiếu nại</a>
                </div>
            </div>

            <!-- MARKETING -->
            <div class="nav-group-acc" data-group="mkt" data-collapsed="true">
                <button class="nav-group-btn" type="button" aria-expanded="false">
                    <span class="nav-label">Marketing</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-group-panel collapsed">
                    <a href="#" class="nav-item" data-page="segmentation.html" data-title="Phân khúc khách hàng"><i class="fas fa-users-cog"></i> Phân khúc</a>
                    <a href="#" class="nav-item" data-page="automation_zns.html" data-title="Chăm sóc tự động ZNS"><i class="fas fa-paper-plane"></i> Automation (ZNS)</a>
                </div>
            </div>

            <!-- FINANCE -->
            <div class="nav-group-acc" data-group="finance" data-collapsed="true">
                <button class="nav-group-btn" type="button" aria-expanded="false">
                    <span class="nav-label">Tài chính</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-group-panel collapsed">
                    <a href="#" class="nav-item" data-page="credit_ar.html" data-title="Tín dụng & công nợ"><i class="fas fa-shield-alt"></i> Tín dụng & Công nợ</a>
                    <a href="#" class="nav-item" data-page="cod_management.html" data-title="Thu hộ COD"><i class="fas fa-hand-holding-usd"></i> Thu hộ COD</a>
                    <a href="#" class="nav-item" data-page="cod_reconciliation.html" data-title="Đối soát & thanh toán"><i class="fas fa-sync-alt"></i> Đối soát & Thanh toán</a>
                    <a href="#" class="nav-item" data-page="e_invoice.html" data-title="Hóa đơn điện tử VAT"><i class="fas fa-file-invoice-dollar"></i> Hóa đơn điện tử</a>
                </div>
            </div>

            <!-- ADMIN -->
            <div class="nav-group-acc" data-group="admin" data-collapsed="true">
                <button class="nav-group-btn" type="button" aria-expanded="false">
                    <span class="nav-label">Quản trị</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-group-panel collapsed">
                    <a href="#" class="nav-item" data-page="user_roles.html" data-title="Người dùng & phân quyền"><i class="fas fa-user-lock"></i> Người dùng & Phân quyền</a>
                    <a href="#" class="nav-item" data-page="settings.html" data-title="Cài đặt"><i class="fas fa-cog"></i> Cài đặt</a>
                </div>
            </div>
        </nav>
    </aside>


    <main class="main-container">
        <header class="top-bar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Tìm khách hàng, vận đơn hoặc báo giá...">
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <i class="far fa-bell" style="font-size: 1.2rem; color: var(--text-muted); cursor: pointer;"></i>
                <div style="text-align: right;">
                    <p style="font-size: 0.85rem; font-weight: 600;">Lê Văn Admin</p>
                    <p style="font-size: 0.7rem; color: var(--text-muted);">Quản trị hệ thống</p>
                </div>
                <img src="https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff" style="width: 35px; border-radius: 8px;">
            </div>
        </header>

        <!-- Dynamic content area: default home content -->
        <div id="contentArea">
        <section class="stats-bar">
            <div class="stat-item">
                <div class="stat-icon" style="background: #e0f2fe; color: #0369a1;"><i class="fas fa-file-invoice"></i></div>
                <div class="stat-info"><h5>Báo giá mới</h5><span>24</span></div>
            </div>
            <div class="stat-item">
                <div class="stat-icon" style="background: #dcfce7; color: #15803d;"><i class="fas fa-box-open"></i></div>
                <div class="stat-info"><h5>Đang giao</h5><span>1,420</span></div>
            </div>
            <div class="stat-item">
                <div class="stat-icon" style="background: #fef9c3; color: #a16207;"><i class="fas fa-exclamation-circle"></i></div>
                <div class="stat-info"><h5>Sự cố phát sinh</h5><span>03</span></div>
            </div>
            <div class="stat-item">
                <div class="stat-icon" style="background: #ede9fe; color: #6d28d9;"><i class="fas fa-comments"></i></div>
                <div class="stat-info"><h5>Ticket hỗ trợ</h5><span>12</span></div>
            </div>
        </section>

        <div class="section-header">
            <h3>THƯƠNG MẠI & ĐỐI TÁC</h3>
            <div class="line"></div>
        </div>
        <div class="module-grid">
            <div class="module-card" data-page="customer_360.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-user-circle"></i></div>
                    <h4>Quản lý Khách hàng (360º) </h4>
                </div>
                <p>Hồ sơ tập trung, lưu lịch sử gửi hàng, sản lượng và thông tin pháp lý từ MST.</p>
            </div>
            <div class="module-card" data-page="leads_opportunities.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-funnel-dollar"></i></div>
                    <h4>Lead & Cơ hội Bán hàng </h4>
                </div>
                <p>Thu thập lead đa kênh (Zalo, FB, Web) và quản lý pipeline Kanban.</p>
            </div>
            <div class="module-card" data-page="contract_management.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-file-signature"></i></div>
                    <h4>Hợp đồng & Bảng giá </h4>
                </div>
                <p>Thiết lập ma trận giá theo vùng, trọng lượng và nhắc nhở gia hạn hợp đồng.</p>
            </div>
            <div class="module-card" data-page="quotation_management.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-calculator"></i></div>
                    <h4>Quản lý Báo giá </h4>
                </div>
                <p>Tự động tính cước, áp phụ phí và xuất file báo giá PDF gửi khách hàng.</p>
            </div>
            <div class="module-card" data-page="segmentation.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-users-cog"></i></div>
                    <h4>Phân khúc & Chăm sóc KH </h4>
                </div>
                <p>Tự động hóa thông báo hành trình qua Zalo ZNS và phân khúc khách hàng mục tiêu.</p>
            </div>
        </div>

        <div class="section-header">
            <h3>VẬN HÀNH & GIÁM SÁT</h3>
            <div class="line"></div>
        </div>
        <div class="module-grid">
            <div class="module-card" data-page="orders_monitoring.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-boxes"></i></div>
                    <h4>Quản lý Đơn hàng </h4>
                </div>
                <p>Giám sát trạng thái vận đơn thời gian thực và cập nhật lộ trình từ TMS.</p>
            </div>
            <div class="module-card" data-page="incidents_alerts.html">
                <span class="badge badge-alert">3 Sự cố</span>
                <div class="card-top">
                    <div class="icon-box" style="color: var(--danger); background: #fef2f2;"><i class="fas fa-bullhorn"></i></div>
                    <h4>Theo dõi Sự cố & Cảnh báo </h4>
                </div>
                <p>Phát hiện đơn hàng nằm kho quá 24h hoặc sai lệch lộ trình vận chuyển.</p>
            </div>
            <div class="module-card" data-page="ticketing.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-headset"></i></div>
                    <h4>Ticket CSKH & Khiếu nại </h4>
                </div>
                <p>Hợp nhất yêu cầu từ Hotline, Email, Zalo về một giao diện xử lý tập trung.</p>
            </div>
        </div>

        <div class="section-header">
            <h3>TÀI CHÍNH & COD</h3>
            <div class="line"></div>
        </div>
        <div class="module-grid">
            <div class="module-card" data-page="cod_management.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-hand-holding-usd"></i></div>
                    <h4>Quản lý Thu hộ COD </h4>
                </div>
                <p>Ghi nhận COD trên vận đơn và theo dõi trạng thái thu tiền của tài xế.</p>
            </div>
            <div class="module-card" data-page="cod_reconciliation.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-sync-alt"></i></div>
                    <h4>Đối soát & Thanh toán </h4>
                </div>
                <p>Tự động đối chiếu COD định kỳ và tích hợp cổng ngân hàng để thanh toán cho khách.</p>
            </div>
            <div class="module-card" data-page="credit_ar.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-shield-alt"></i></div>
                    <h4>Tín dụng & Công nợ </h4>
                </div>
                <p>Thiết lập Credit Limit và tự động chặn đơn nếu khách hàng nợ quá hạn.</p>
            </div>
            <div class="module-card" data-page="e_invoice.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-file-invoice-dollar"></i></div>
                    <h4>Hóa đơn Điện tử VAT </h4>
                </div>
                <p>Tự động phát hành hóa đơn khi hoàn thành đơn và đồng bộ phần mềm kế toán.</p>
            </div>
        </div>

        <div class="section-header">
            <h3>QUẢN TRỊ HỆ THỐNG</h3>
            <div class="line"></div>
        </div>
        <div class="module-grid">
            <div class="module-card" data-page="bi_dashboard.html">
                <div class="card-top">
                    <div class="icon-box" style="background: #fff7ed; color: #f97316;"><i class="fas fa-chart-line"></i></div>
                    <h4>Dashboard Ban lãnh đạo</h4>
                </div>
                <p>Báo cáo doanh thu, sản lượng, tỷ lệ giao hàng đúng hạn và điểm NPS.</p>
            </div>
            <div class="module-card" data-page="user_roles.html">
                <div class="card-top">
                    <div class="icon-box"><i class="fas fa-user-lock"></i></div>
                    <h4>Người dùng & Phân quyền </h4>
                </div>
                <p>Quản lý vai trò (Role), quyền truy cập module và nhật ký hoạt động (Audit log).</p>
            </div>
        </div>
        </div>
    </main>


<script>
(function(){
  // Accordion toggles
  document.querySelectorAll('.nav-group-acc .nav-group-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const group = btn.closest('.nav-group-acc');
      const panel = group.querySelector('.nav-group-panel');
      const isCollapsed = panel.classList.contains('collapsed');
      panel.classList.toggle('collapsed');
      group.dataset.collapsed = (!isCollapsed).toString();
      btn.setAttribute('aria-expanded', isCollapsed ? 'true' : 'false');
    });
  });

  // Active state (simple)
  document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
      item.classList.add('active');
    });
  });

  // Sidebar search: filter items + auto expand matching groups
  const input = document.getElementById('sidebarSearch');
  if(input){
    input.addEventListener('input', () => {
      const q = input.value.trim().toLowerCase();
      document.querySelectorAll('.nav-group-acc').forEach(group => {
        let any = false;
        group.querySelectorAll('.nav-item').forEach(a => {
          const t = (a.dataset.title || a.textContent).toLowerCase();
          const show = !q || t.includes(q);
          a.style.display = show ? 'flex' : 'none';
          if(show) any = true;
        });
        // show/hide entire group (keep label)
        group.style.display = any ? 'block' : 'none';
        // auto expand when searching
        const panel = group.querySelector('.nav-group-panel');
        if(q && any){
          panel.classList.remove('collapsed');
          group.dataset.collapsed = "false";
          group.querySelector('.nav-group-btn')?.setAttribute('aria-expanded','true');
        }
        if(!q){
          // reset groups: keep initial collapsed state based on markup
          // (do nothing)
        }
      });
    });
  }

  // ===== Dynamic page loader =====
  const contentArea = document.getElementById('contentArea');
  // Store the initial dashboard/home markup to restore when nothing is selected
  const homeHTML = contentArea ? contentArea.innerHTML : '';

  /**
   * Highlight the nav item that corresponds to the given page file.
   * If no matching nav-item is found, all nav-item active states are cleared.
   * @param {string} page
   */
  function highlightNav(page){
    // Remove active class from all nav items
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    if(!page){
      // Reset to home: highlight the overview nav item (first item)
      const overview = document.querySelector('.nav-item[data-page=""]');
      if(overview) overview.classList.add('active');
      return;
    }
    // Find nav item with matching data-page
    const targetNav = document.querySelector('.nav-item[data-page="'+page+'"]');
    if(targetNav){
      targetNav.classList.add('active');
      // Ensure its parent group is expanded
      const group = targetNav.closest('.nav-group-acc');
      if(group){
        const panel = group.querySelector('.nav-group-panel');
        panel.classList.remove('collapsed');
        group.dataset.collapsed = "false";
        const btn = group.querySelector('.nav-group-btn');
        if(btn) btn.setAttribute('aria-expanded','true');
      }
    }
  }

  /**
   * Load a partial HTML page into the main content area. The page should contain
   * only the main section content, without duplicating the sidebar or top bar.
   * If no page is provided, the default home content will be restored.
   * @param {string|null} page
   */
  function loadPage(page){
    if(!contentArea) return;
    // Highlight nav corresponding to this page
    highlightNav(page || '');
    if(!page){
      contentArea.innerHTML = homeHTML;
      return;
    }
    // Display a simple loading indicator while the iframe loads
    contentArea.innerHTML = '<div style="padding:2rem;text-align:center;font-size:0.9rem;color:'+getComputedStyle(document.documentElement).getPropertyValue('--text-muted')+'">Đang tải dữ liệu...</div>';
    // Create iframe element dynamically
    const iframe = document.createElement('iframe');
    iframe.src = page;
    iframe.style.width = '100%';
    // height: full viewport minus header and some padding; adjust if needed
    // Adjust the iframe height so loaded pages better fill the available space.
    // The previous value (200px) left too much unused grey area at the bottom when
    // a page contained less content. A smaller offset ensures the iframe expands
    // vertically to nearly the entire viewport minus the top bar and padding.
    // Fill the viewport more by reducing the offset. This value should be tuned
    // according to the height of the top bar and any padding. A smaller value
    // leaves less unused space at the bottom when pages have less content.
    iframe.style.height = 'calc(100vh - 100px)';
    iframe.style.border = '0';
    // When iframe loads, remove loading text and append iframe
    iframe.onload = () => {
      // Replace loading content with iframe
      if(contentArea.contains(iframe)) return; // already inserted
      contentArea.innerHTML = '';
      contentArea.appendChild(iframe);
    };
    // Fallback: If iframe cannot load (e.g., file not found), show a friendly message
    iframe.onerror = () => {
      contentArea.innerHTML = '<div style="padding:2rem;text-align:center;font-size:0.9rem;color:'+getComputedStyle(document.documentElement).getPropertyValue('--danger')+'">Không tìm thấy trang hoặc trang đang trong quá trình phát triển.</div>';
    };
    // Insert iframe into content area (it will load soon)
    contentArea.innerHTML = '';
    contentArea.appendChild(iframe);
  }
  // Attach click listeners to nav items with data-page
  document.querySelectorAll('.nav-item[data-page]').forEach(el => {
    el.addEventListener('click', function(e){
      e.preventDefault();
      const page = this.getAttribute('data-page');
      loadPage(page);
    });
  });
  // Attach click listeners to module cards with data-page (event delegation so it works after returning Home)
  document.addEventListener('click', (e) => {
    const card = e.target.closest('.module-card[data-page]');
    if(!card) return;
    const page = card.getAttribute('data-page');
    if(page !== null) loadPage(page);
  });
})();
</script>

</body>
</html>
