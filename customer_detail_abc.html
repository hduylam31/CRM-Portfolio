<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chi tiết khách hàng - Cty ABC Trading</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --primary-blue:#0f172a;
      --accent-blue:#3b82f6;
      --bg-light:#f8fafc;
      --card-white:#ffffff;
      --text-main:#334155;
      --text-muted:#64748b;
      --border-color:#e2e8f0;
      --success:#10b981;
      --warning:#f59e0b;
      --danger:#ef4444;
      --shadow: 0 12px 24px rgba(0,0,0,0.06);
    }
    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family:'Inter', sans-serif;
      background: var(--bg-light);
      color: var(--text-main);
    }
    a{ color: inherit; text-decoration:none; }

    /* ===== Buttons (ticketing-like) ===== */
    .btn{
      border: 1px solid var(--border-color);
      background: #fff;
      color: var(--text-main);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 600;
      font-size: .85rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      transition: .2s;
      white-space: nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(0,0,0,0.06);
      border-color:#cbd5e1;
    }
    .btn.primary{ background: var(--accent-blue); border-color: var(--accent-blue); color:#fff; }
    .btn.primary:hover{ box-shadow: 0 14px 26px rgba(59,130,246,0.22); }
    .btn.ghost{ background: transparent; border-color: transparent; color: var(--text-muted); }
    .btn.ghost:hover{ transform:none; box-shadow:none; background:#fff; border-color: var(--border-color); color: var(--text-main); }
    .mini-btn{
      width: 34px; height: 34px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      background:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--text-muted);
      transition:.2s;
    }
    .mini-btn:hover{
      border-color:#cbd5e1;
      color: var(--text-main);
      box-shadow: 0 10px 18px rgba(0,0,0,0.06);
      transform: translateY(-1px);
    }

    .pill{
      font-size: .7rem;
      padding: 3px 9px;
      border-radius: 999px;
      font-weight: 700;
      border: 1px solid transparent;
      display:inline-flex;
      align-items:center;
      gap: 6px;
      line-height: 1;
      white-space: nowrap;
    }
    .pill.blue{ background:#e0f2fe; color:#0369a1; border-color:#bae6fd; }
    .pill.green{ background:#dcfce7; color:#15803d; border-color:#bbf7d0; }
    .pill.yellow{ background:#fef9c3; color:#a16207; border-color:#fde68a; }
    .pill.red{ background:#fee2e2; color:#b91c1c; border-color:#fecaca; }
    .pill.purple{ background:#ede9fe; color:#5b21b6; border-color:#ddd6fe; }
    .pill.gray{ background:#f1f5f9; color:#475569; border-color:#e2e8f0; }

    /* ===== Sticky header ===== */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(248,250,252,0.85);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(226,232,240,0.9);
      padding: 0.9rem 1.25rem;
    }
    .topbar-inner{
      max-width: 1680px;
      margin: 0 auto;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 280px;
    }
    .title h1{
      margin:0;
      font-size: 1.05rem;
      font-weight: 800;
      color: var(--primary-blue);
      display:flex;
      align-items:center;
      gap: 10px;
      letter-spacing: .2px;
    }
    .title .desc{
      margin:0;
      color: var(--text-muted);
      font-size: .82rem;
      font-weight: 600;
    }
    .meta-row{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      align-items:center;
    }
    .actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    .page{
      max-width: 1680px;
      margin: 0 auto;
      padding: 1.25rem;
    }

    /* ===== Cards / grids ===== */
    .grid-2{ display:grid; grid-template-columns: 2fr 1fr; gap: 1rem; }
    .grid-2-equal{ display:grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .grid-3{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    .card{
      background:#fff;
      border:1px solid var(--border-color);
      border-radius: 16px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.03);
      overflow:hidden;
    }
    .card-head{
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .card-head h3{
      margin:0;
      font-size: .92rem;
      font-weight: 800;
      color: var(--primary-blue);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .card-body{ padding: 1rem; }

    .info-grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px 16px;
      font-size: .88rem;
    }
    .info-grid .item .label{
      display:block;
      font-size:.72rem;
      color: var(--text-muted);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .25px;
      margin-bottom: 4px;
    }
    .info-grid .item .value{
      font-weight: 700;
      color: var(--primary-blue);
    }
    .muted{ color: var(--text-muted); font-weight: 600; }

    .table-wrap{
      border:1px solid var(--border-color);
      border-radius: 14px;
      overflow:auto;
      max-height: 320px;
    }
    table{ width:100%; border-collapse: separate; border-spacing: 0; font-size: .86rem; }
    thead th{
      text-align:left;
      padding: 10px 12px;
      color: var(--text-muted);
      font-size: .72rem;
      text-transform: uppercase;
      letter-spacing: .25px;
      font-weight: 600;
      border-bottom: 1px solid var(--border-color);
      background: #fff;
      position: sticky;
      top: 0;
      z-index: 1;
      white-space: nowrap;
    }
    tbody td{ padding: 10px 12px; border-bottom: 1px solid var(--border-color); vertical-align: top; }
    tbody tr:hover{ background:#f8fafc; }
    tr.row-link{ cursor:pointer; }

    /* KPI cards */
    .kpi-row{ display:grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    .kpi{
      border:1px solid var(--border-color);
      border-radius: 16px;
      padding: 12px 14px;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .kpi .left{ display:flex; flex-direction:column; gap: 4px; }
    .kpi .t{ font-size:.72rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase; letter-spacing: .25px; }
    .kpi .v{ font-size: 1.12rem; font-weight: 800; color: var(--primary-blue); line-height: 1.1; }
    .kpi .s{ font-size:.8rem; font-weight: 700; }
    .kpi .s.up{ color: var(--success); }
    .kpi .s.down{ color: var(--danger); }
    .kpi .ic{
      width: 38px; height: 38px;
      border-radius: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
      background:#eef2ff;
      color:#3730a3;
    }

    /* Charts */
    .chart-box{ height: 260px; }
    .chart-box.small{ height: 220px; }
    canvas{ width:100% !important; height:100% !important; }

    .note{
      font-size:.84rem;
      color: var(--text-muted);
      font-weight: 600;
      line-height: 1.4;
    }

    @media (max-width: 1200px){
      .grid-2{ grid-template-columns: 1fr; }
      .grid-3{ grid-template-columns: 1fr; }
      .grid-2-equal{ grid-template-columns: 1fr; }
      .kpi-row{ grid-template-columns: 1fr 1fr; }
      .actions{ justify-content:flex-start; }
    }
    @media (max-width: 560px){
      .page{ padding: .9rem; }
      .topbar{ padding: .75rem .9rem; }
      .kpi-row{ grid-template-columns: 1fr; }
      .info-grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="title">
        <div class="meta-row">
          <a class="btn" href="customer_360.html"><i class="fa-solid fa-arrow-left"></i> Quay lại</a>
          <span class="pill gray"><i class="fa-solid fa-briefcase"></i> Sales & Khách hàng</span>
          <span class="pill blue"><i class="fa-solid fa-address-book"></i> Customer 360</span>
          <span class="pill yellow"><i class="fa-solid fa-crown"></i> Key Account</span>
        </div>
        <h1><i class="fa-solid fa-building" style="color:var(--accent-blue)"></i> Cty ABC Trading</h1>
        <p class="desc">Chi tiết thông tin khách hàng, vận hành & tài chính (mẫu prototype).</p>
      </div>

      <div class="actions">
        <a class="btn" href="master_data_form.html"><i class="fa-solid fa-pen"></i> Chỉnh sửa</a>
        <a class="btn" href="quotation_management.html"><i class="fa-solid fa-file-invoice"></i> Tạo báo giá</a>
        <a class="btn" href="shipment_module.html"><i class="fa-solid fa-truck-fast"></i> Tạo vận đơn</a>
        <a class="btn" href="price_list_rules.html"><i class="fa-solid fa-tags"></i> Bảng giá riêng</a>
        <a class="btn" href="ticketing_wide_fixed.html"><i class="fa-solid fa-headset"></i> Tạo ticket</a>
        <button class="btn primary" type="button" id="btnNewInvoice"><i class="fa-solid fa-receipt"></i> Tạo hóa đơn</button>
      </div>
    </div>
  </div>

  <div class="page">
    <!-- Overview + Contacts -->
    <div class="grid-2" style="margin-bottom:1rem;">
      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-circle-info" style="color:var(--accent-blue)"></i> Thông tin chung</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
            <span class="pill green"><i class="fa-solid fa-circle"></i> Active</span>
            <span class="pill gray"><i class="fa-regular fa-clock"></i> Updated: Hôm qua</span>
          </div>
        </div>
        <div class="card-body">
          <div class="info-grid">
            <div class="item"><span class="label">Tên khách hàng</span><span class="value">Cty ABC Trading</span></div>
            <div class="item"><span class="label">Mã số thuế (MST)</span><span class="value">0101234567</span></div>
            <div class="item"><span class="label">Loại khách</span><span class="value">B2B</span></div>
            <div class="item"><span class="label">Phân khúc</span><span class="value">Key Account</span></div>
            <div class="item"><span class="label">Hạn mức tín dụng</span><span class="value">2,000,000,000 VND</span></div>
            <div class="item"><span class="label">Điều kiện thanh toán</span><span class="value">Net 30</span></div>
            <div class="item"><span class="label">Địa chỉ trụ sở</span><span class="value">Số 10 Xã Đàn, Đống Đa, Hà Nội</span></div>
            <div class="item"><span class="label">Địa chỉ kho</span><span class="value">Kho Hà Nội • Kho Hồ Chí Minh</span></div>
          </div>

          <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
            <span class="pill gray"><i class="fa-solid fa-link"></i> Parent: Tập đoàn XYZ</span>
            <span class="pill gray"><i class="fa-solid fa-tag"></i> Tags: VIP, Hỏa tốc</span>
            <span class="pill gray"><i class="fa-solid fa-location-dot"></i> Default Hub: HN</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-user-group" style="color:var(--accent-blue)"></i> Người liên hệ</h3>
          <div style="display:flex; gap:8px;">
            <button class="mini-btn" title="Call (mock)" onclick="event.stopPropagation(); alert('Gọi (mock) — sẽ gọi Contact Primary.');"><i class="fa-solid fa-phone"></i></button>
            <button class="mini-btn" title="Email (mock)" onclick="event.stopPropagation(); window.location.href='mailto:a.nguyen@abc.com';"><i class="fa-solid fa-envelope"></i></button>
            <button class="mini-btn" title="Zalo (mock)" onclick="event.stopPropagation(); alert('Zalo (mock) — sẽ mở chat với Contact Primary.');"><i class="fa-brands fa-rocketchat"></i></button>
          </div>
        </div>
        <div class="card-body">
          <div class="table-wrap" style="max-height: 260px;">
            <table>
              <thead>
                <tr>
                  <th>Họ tên</th><th>Chức vụ</th><th>Email</th><th>Điện thoại</th>
                </tr>
              </thead>
              <tbody>
                <tr class="row-link" data-href="contact_detail.html?contact=CT-001&customer=CUS-000245">
                  <td>
                    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                      <b style="color:var(--primary-blue);">Nguyễn Văn A</b>
                      <span class="pill blue"><i class="fa-solid fa-star"></i> Primary</span>
                    </div>
                  </td>
                  <td>Giám đốc</td>
                  <td class="muted">a.nguyen@abc.com</td>
                  <td class="muted">0901 234 567</td>
                </tr>
                <tr class="row-link" data-href="contact_detail.html?contact=CT-002&customer=CUS-000245">
                  <td>
                    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                      <b style="color:var(--primary-blue);">Lê Thị B</b>
                      <span class="pill gray"><i class="fa-solid fa-file-invoice"></i> Billing</span>
                    </div>
                  </td>
                  <td>Kế toán</td>
                  <td class="muted">b.le@abc.com</td>
                  <td class="muted">0902 345 678</td>
                </tr>
                <tr class="row-link" data-href="contact_detail.html?contact=CT-003&customer=CUS-000245">
                  <td>
                    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                      <b style="color:var(--primary-blue);">Trần Văn C</b>
                      <span class="pill gray"><i class="fa-solid fa-headset"></i> Ops/CS</span>
                    </div>
                  </td>
                  <td>CSKH</td>
                  <td class="muted">c.tran@abc.com</td>
                  <td class="muted">0903 456 789</td>
                </tr>
</tbody>
            </table>
          </div>

          <div style="margin-top:10px;" class="note">
            • Tip: với Key Account, nên có ít nhất 1 contact “Kế toán” để đối soát công nợ.
          </div>
        </div>
      </div>
    </div>

    <!-- KPIs -->
    <div class="card" style="margin-bottom:1rem;">
      <div class="card-head">
        <h3><i class="fa-solid fa-chart-simple" style="color:var(--accent-blue)"></i> KPI tổng quan</h3>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <span class="pill gray"><i class="fa-solid fa-calendar"></i> Period: 12 tháng</span>
          <span class="pill gray"><i class="fa-solid fa-route"></i> Main Lane: HN – HCM</span>
        </div>
      </div>
      <div class="card-body">
        <div class="kpi-row">
          <div class="kpi">
            <div class="left"><div class="t">Tổng số đơn</div><div class="v">2,560</div><div class="s up">▲ 5.5%</div></div>
            <div class="ic" style="background:#e0f2fe;color:#0369a1;"><i class="fa-solid fa-box"></i></div>
          </div>
          <div class="kpi">
            <div class="left"><div class="t">Tổng doanh thu</div><div class="v">4.5B</div><div class="s up">▲ 7.2%</div></div>
            <div class="ic" style="background:#dcfce7;color:#15803d;"><i class="fa-solid fa-coins"></i></div>
          </div>
          <div class="kpi">
            <div class="left"><div class="t">Tần suất gửi</div><div class="v">4.8/ngày</div><div class="s up">▲ 3.1%</div></div>
            <div class="ic" style="background:#ede9fe;color:#5b21b6;"><i class="fa-solid fa-arrow-trend-up"></i></div>
          </div>
          <div class="kpi">
            <div class="left"><div class="t">On-time</div><div class="v">94.3%</div><div class="s down">▼ 0.6%</div></div>
            <div class="ic" style="background:#fef9c3;color:#a16207;"><i class="fa-solid fa-stopwatch"></i></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts + Routes + Service distribution -->
    <div class="grid-3" style="margin-bottom:1rem;">
      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-chart-line" style="color:var(--accent-blue)"></i> Lịch sử gửi hàng</h3>
          <span class="pill gray"><i class="fa-solid fa-wave-square"></i> Monthly</span>
        </div>
        <div class="card-body">
          <div class="chart-box">
            <canvas id="shipmentHistory"></canvas>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-route" style="color:var(--accent-blue)"></i> Tuyến thường sử dụng</h3>
          <span class="pill gray"><i class="fa-solid fa-truck"></i> Top 5</span>
        </div>
        <div class="card-body">
          <div class="table-wrap" style="max-height: 260px;">
            <table>
              <thead><tr><th>Tuyến</th><th>#Đơn</th><th>Doanh thu</th><th>On-time</th></tr></thead>
              <tbody>
                <tr><td><b>HN – HCM</b></td><td>1,200</td><td>2.1B</td><td><span class="pill green">95%</span></td></tr>
                <tr><td>HCM – DN</td><td>650</td><td>1.0B</td><td><span class="pill green">94%</span></td></tr>
                <tr><td>HN – HP</td><td>300</td><td>0.6B</td><td><span class="pill green">93%</span></td></tr>
                <tr><td>DN – HN</td><td>250</td><td>0.5B</td><td><span class="pill yellow">92%</span></td></tr>
                <tr><td>HCM – CT</td><td>160</td><td>0.3B</td><td><span class="pill yellow">90%</span></td></tr>
              </tbody>
            </table>
          </div>
          <div style="margin-top:10px;" class="note">
            • Gợi ý: nếu On-time <b>&lt; 92%</b> trong 7 ngày → tự tạo Ticket “Quality”.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-chart-pie" style="color:var(--accent-blue)"></i> Phân bổ dịch vụ</h3>
          <span class="pill gray"><i class="fa-solid fa-layer-group"></i> Mix</span>
        </div>
        <div class="card-body">
          <div class="chart-box small">
            <canvas id="serviceDistribution"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Finance / Ops / CRM blocks -->
    <div class="grid-3" style="margin-bottom:1rem;">
      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-receipt" style="color:var(--accent-blue)"></i> Tài chính & Thuế</h3>
          <span class="pill gray"><i class="fa-solid fa-file-invoice"></i> VAT</span>
        </div>
        <div class="card-body">
          <div class="info-grid">
            <div class="item"><span class="label">Mã nội bộ</span><span class="value">CUS-2026-001</span></div>
            <div class="item"><span class="label">Tiền tệ</span><span class="value">VND</span></div>
            <div class="item"><span class="label">Ngân hàng</span><span class="value">BIDV • 123456789</span></div>
            <div class="item"><span class="label">Tax Profile</span><span class="value">VAT 10%</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-warehouse" style="color:var(--accent-blue)"></i> Vận hành & Logistics</h3>
          <span class="pill gray"><i class="fa-solid fa-truck-fast"></i> SLA</span>
        </div>
        <div class="card-body">
          <div class="info-grid">
            <div class="item"><span class="label">Incoterms</span><span class="value">FOB</span></div>
            <div class="item"><span class="label">Kho mặc định</span><span class="value">Kho Hà Nội</span></div>
            <div class="item"><span class="label">Lead Time</span><span class="value">3 ngày</span></div>
            <div class="item"><span class="label">3PL Partner</span><span class="value">—</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-bullhorn" style="color:var(--accent-blue)"></i> CRM & Marketing</h3>
          <span class="pill gray"><i class="fa-solid fa-circle-nodes"></i> Automation</span>
        </div>
        <div class="card-body">
          <div class="info-grid">
            <div class="item"><span class="label">Nguồn khách</span><span class="value">Referral</span></div>
            <div class="item"><span class="label">Owner</span><span class="value">Sales Team A</span></div>
            <div class="item"><span class="label">Segment</span><span class="value">Key Account</span></div>
            <div class="item"><span class="label">ZNS</span><span class="value">Enabled</span></div>
          </div>
          <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
            <a class="btn ghost" href="segmentation_wide_v3.html"><i class="fa-solid fa-layer-group"></i> Segmentation</a>
            <a class="btn ghost" href="automation_zns.html"><i class="fa-solid fa-paper-plane"></i> Automation ZNS</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Contracts & Pricing -->
    <div class="grid-2-equal" style="margin-bottom:1rem;">
      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-file-signature" style="color:var(--accent-blue)"></i> Hợp đồng</h3>
          <a class="btn ghost" href="contract_create.html"><i class="fa-solid fa-plus"></i> Tạo hợp đồng</a>
        </div>
        <div class="card-body">
          <div class="table-wrap" style="max-height: 240px;">
            <table>
              <thead><tr><th>Mã hợp đồng</th><th>Hiệu lực</th><th>Hết hạn</th><th>Trạng thái</th></tr></thead>
              <tbody>
                <tr><td><b>HD-2025-001</b></td><td>01/01/2025</td><td>31/12/2025</td><td><span class="pill green">Đang hiệu lực</span></td></tr>
                <tr><td>HD-2024-002</td><td>01/01/2024</td><td>31/12/2024</td><td><span class="pill gray">Đã hết hạn</span></td></tr>
                <tr><td>HD-2023-003</td><td>01/01/2023</td><td>31/12/2023</td><td><span class="pill gray">Đã hết hạn</span></td></tr>
              </tbody>
            </table>
          </div>
          <div style="margin-top:10px;" class="note">
            • Hệ thống sẽ nhắc trước <b>30 ngày</b> khi hợp đồng gần hết hạn.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-tags" style="color:var(--accent-blue)"></i> Bảng giá áp dụng</h3>
          <a class="btn ghost" href="price_list_rules.html"><i class="fa-solid fa-plus"></i> Tạo bảng giá</a>
        </div>
        <div class="card-body">
          <div class="table-wrap" style="max-height: 240px;">
            <table>
              <thead><tr><th>Tên bảng giá</th><th>Dịch vụ</th><th>Vùng</th><th>Giá</th></tr></thead>
              <tbody>
                <tr><td><b>Giá Cố định HN-HCM</b></td><td>Nhanh</td><td>HN–HCM</td><td>25,000 VND/kg</td></tr>
                <tr><td>Giá Tiết kiệm</td><td>Tiết kiệm</td><td>Toàn quốc</td><td>18,000 VND/kg</td></tr>
                <tr><td>Giá COD ngoại tỉnh</td><td>COD</td><td>Miền Nam</td><td>30,000 VND/kg</td></tr>
              </tbody>
            </table>
          </div>
          <div style="margin-top:10px;" class="note">
            • Tip: với Key Account, nên ưu tiên bảng giá theo <b>tuyến + trọng lượng</b>.
          </div>
        </div>
      </div>
    </div>

    <!-- Credit & Invoices -->
    <div class="grid-2-equal" style="margin-bottom:1rem;">
      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-shield" style="color:var(--accent-blue)"></i> Tín dụng & Công nợ</h3>
          <span class="pill gray"><i class="fa-solid fa-scale-balanced"></i> AR</span>
        </div>
        <div class="card-body">
          <div class="info-grid">
            <div class="item"><span class="label">Hạn mức tín dụng</span><span class="value">2,000,000,000 VND</span></div>
            <div class="item"><span class="label">Dư nợ hiện tại</span><span class="value">500,000,000 VND</span></div>
            <div class="item"><span class="label">Số ngày được nợ</span><span class="value">30 ngày</span></div>
            <div class="item"><span class="label">Trạng thái</span><span class="value">Ổn định</span></div>
          </div>
          <div style="margin-top:12px;" class="note">
            • Nếu dư nợ vượt 80% hạn mức → tự động cảnh báo và chặn tạo đơn theo policy.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h3><i class="fa-solid fa-file-invoice-dollar" style="color:var(--accent-blue)"></i> Hóa đơn & COD</h3>
          <span class="pill gray"><i class="fa-solid fa-receipt"></i> Billing</span>
        </div>
        <div class="card-body">
          <div class="table-wrap" style="max-height: 240px;">
            <table>
              <thead><tr><th>#Hóa đơn</th><th>Ngày</th><th>Số tiền</th><th>Đến hạn</th><th>Trạng thái</th></tr></thead>
              <tbody>
                <tr><td><b>INV-001</b></td><td>15/12/2025</td><td>150M</td><td>14/01/2026</td><td><span class="pill yellow">Chưa TT</span></td></tr>
                <tr><td>INV-002</td><td>30/11/2025</td><td>200M</td><td>30/12/2025</td><td><span class="pill yellow">Chưa TT</span></td></tr>
                <tr><td>INV-003</td><td>01/10/2025</td><td>100M</td><td>31/10/2025</td><td><span class="pill green">Đã TT</span></td></tr>
              </tbody>
            </table>
          </div>
          <div style="margin-top:10px;" class="note">
            • COD sẽ được đối soát theo kỳ và đồng bộ vào “Đối soát & Thanh toán”.
          </div>
        </div>
      </div>
    </div>

    <!-- Notes / Alerts -->
    <div class="card" style="margin-bottom:1rem;">
      <div class="card-head">
        <h3><i class="fa-solid fa-triangle-exclamation" style="color:var(--warning)"></i> Ghi chú & Cảnh báo</h3>
        <span class="pill gray"><i class="fa-solid fa-bell"></i> Rules</span>
      </div>
      <div class="card-body">
        <div class="note">
          Không có cảnh báo đặc biệt. Hệ thống sẽ tự động nhắc:
          <br/>• Trước <b>30 ngày</b> khi hợp đồng gần hết hạn.
          <br/>• Khi dư nợ vượt ngưỡng (mặc định <b>80%</b> hạn mức tín dụng).
          <br/>• Khi tỷ lệ giao đúng hạn giảm dưới <b>92%</b> trong 7 ngày.
        </div>
      </div>
    </div>

    <!-- Permissions -->
    <div class="card">
      <div class="card-head">
        <h3><i class="fa-solid fa-user-shield" style="color:var(--accent-blue)"></i> Phân quyền chỉnh sửa</h3>
        <span class="pill gray"><i class="fa-solid fa-lock"></i> RBAC</span>
      </div>
      <div class="card-body">
        <div class="note">
          <b>Nhóm 1 – Thông tin liên hệ:</b> Sales được sửa Họ tên, chức vụ, số điện thoại, email, Zalo/Facebook, thêm địa chỉ kho.<br/>
          <b>Nhóm 2 – Thông tin giao dịch:</b> Manager được sửa Hạn mức tín dụng, điều kiện thanh toán, bảng giá áp dụng.<br/>
          <b>Nhóm 3 – Thông tin pháp lý:</b> Kế toán được cập nhật thông tin VAT, MST, và tài khoản ngân hàng thụ hưởng.
        </div>
      </div>
    </div>
  </div>

  <script>
    // Chart.js: disable animations for smoother prototype in iframe
    if (window.Chart) Chart.defaults.animation = false;

    document.getElementById("btnNewInvoice").addEventListener("click", () => {
      alert("Tạo hóa đơn (mock) — sẽ mở màn hình tạo hóa đơn/VAT.");
    });

    document.addEventListener("DOMContentLoaded", () => {
      // Shipment history line
      const ctx = document.getElementById('shipmentHistory').getContext('2d');
      new Chart(ctx, {
        type:'line',
        data:{
          labels:['Th1','Th2','Th3','Th4','Th5','Th6','Th7','Th8','Th9','Th10','Th11','Th12'],
          datasets:[{
            label:'Số đơn',
            data:[200,240,280,260,300,320,340,360,380,400,420,450],
            borderColor:getComputedStyle(document.documentElement).getPropertyValue('--accent-blue').trim(),
            backgroundColor:'rgba(59,130,246,0.15)',
            tension:0.35,
            fill:true
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{ legend:{display:false} },
          scales:{ y:{ beginAtZero:true } }
        }
      });

      // Service distribution donut
      const ctxService = document.getElementById('serviceDistribution').getContext('2d');
      new Chart(ctxService, {
        type:'doughnut',
        data:{
          labels:['Nhanh','Tiết kiệm','Hỏa tốc','COD'],
          datasets:[{
            data:[45,25,20,10],
            backgroundColor:[
              getComputedStyle(document.documentElement).getPropertyValue('--accent-blue').trim(),
              '#10b981',
              '#f59e0b',
              '#ef4444'
            ],
            borderWidth:1
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{ legend:{ position:'right' } },
          cutout:'55%'
        }
      });
    });
  </script>

  <script>
    // Click Contact rows -> Contact Detail (linked entity)
    document.addEventListener('click', (e) => {
      const row = e.target.closest('tr.row-link[data-href]');
      if(!row) return;
      window.location.href = row.getAttribute('data-href');
    });
  </script>
</body>
</html>
